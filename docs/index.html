<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Elizabeth Delmelle">
<meta name="author" content="Eric Delmelle">
<meta name="dcterms.date" content="2024-09-24">
<meta name="keywords" content="sequence analysis, neighborhood change, New York City">

<title>Sequence Paper - Sequence Analysis of Neighborhood Racial and Ethnic Changes: The Case of New York City 1980-2020</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body>

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#sec-intro" id="toc-sec-intro" class="nav-link active" data-scroll-target="#sec-intro">Introduction</a></li>
  <li><a href="#sec-compEnv" id="toc-sec-compEnv" class="nav-link" data-scroll-target="#sec-compEnv">Computational environment</a></li>
  <li><a href="#sec-data" id="toc-sec-data" class="nav-link" data-scroll-target="#sec-data">Data</a></li>
  <li><a href="#sec-intuition" id="toc-sec-intuition" class="nav-link" data-scroll-target="#sec-intuition">Basic conceptual intuition</a></li>
  <li><a href="#sec-application" id="toc-sec-application" class="nav-link" data-scroll-target="#sec-application">Application</a>
  <ul class="collapse">
  <li><a href="#study-area" id="toc-study-area" class="nav-link" data-scroll-target="#study-area">Study Area</a></li>
  <li><a href="#exploring-k-means-cluster-solutions" id="toc-exploring-k-means-cluster-solutions" class="nav-link" data-scroll-target="#exploring-k-means-cluster-solutions">Exploring <em>k</em>-means Cluster Solutions</a></li>
  <li><a href="#sequence-analysis" id="toc-sequence-analysis" class="nav-link" data-scroll-target="#sequence-analysis">Sequence Analysis</a></li>
  </ul></li>
  <li><a href="#sec-conclusion" id="toc-sec-conclusion" class="nav-link" data-scroll-target="#sec-conclusion">Conclusions</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Sequence Analysis of Neighborhood Racial and Ethnic Changes: The Case of New York City 1980-2020</h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Authors</div>
  <div class="quarto-title-meta-heading">Affiliations</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Elizabeth Delmelle <a href="https://orcid.org/0000-0003-3735-8359" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            University of Pennsylvania
          </p>
      </div>
      <div class="quarto-title-meta-contents">
    <p class="author">Eric Delmelle <a href="https://orcid.org/0000-0002-5117-2238" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Vrije University Brussels
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 24, 2024</p>
    </div>
  </div>
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="abstract-title">Abstract</div>
    <p>This paper demonstrates the application of sequence analysis to develop a typology of racial and ethnic trajectories in New York City neighborhoods from 1980 to 2020 using a reproducible R workflow. Our workflow begins with using an unsupervised classification method, k-means, at each decennial cross-section to derive 6 classes describing the racial and ethnic makeup of neighborhoods during the study period. These classes include four that depict a majority of Black, White, Hispanic, and Asian residents, and two mixed-race classes, Black and Hispanic, and a White majority with a mixture of other races. We then develop a sequence of classes for each census tract over the 5 decennial time stamps. Finally, we derive a longitudinal typology describing the predominant pathways of change using sequence analysis. This resulted in 14 distinct pathways including transitions to Hispanic and Asian majorities emerging from historically White or Black neighborhoods. The findings underscore the gradual nature of neighborhood racial transformations. Our approach is reproducible for researchers wanting to explore and visualize multidimensional neighborhood dynamics.</p>
  </div>
</div>

</header>

<section id="sec-intro" class="level2">
<h2 class="anchored" data-anchor-id="sec-intro">Introduction</h2>
<p>Tracking and understanding neighborhood changes has been a central topic of urban studies and a fundamental concern for planning practitioners <span class="citation" data-cites="Galster2001 Landis2016 ChappleZuk2016">(<a href="#ref-Galster2001" role="doc-biblioref">Galster 2001</a>; <a href="#ref-Landis2016" role="doc-biblioref">Landis 2016</a>; <a href="#ref-ChappleZuk2016" role="doc-biblioref">Chapple and Zuk 2016</a>)</span>. Neighborhood change can be comprehended according to various dimensions, from housing stock or built environment changes to residents’ demographic and socioeconomic composition <span class="citation" data-cites="Delmelle2022">(<a href="#ref-Delmelle2022" role="doc-biblioref">Delmelle 2022</a>)</span>. Thus, the study of neighborhood change involves analyzing multiple attribute dimensions through time for spatially situated units. Recent scholarship has progressed in the analytical strategies used to study neighborhood trajectories, introducing new methods for visualizing and mapping longitudinal pathways of change for multiple dimensions <span class="citation" data-cites="Delmelle2022">(<a href="#ref-Delmelle2022" role="doc-biblioref">Delmelle 2022</a>)</span>.</p>
<p>In this article, we demonstrate one such technique, sequence analysis, to explore decennial neighborhood racial and ethnic changes in New York City from 1980-2020. The United States’ demographic profile has become increasingly diverse in the past several decades, driven by immigration and growing natural birth rates of the non-White population <span class="citation" data-cites="frey2022new">(<a href="#ref-frey2022new" role="doc-biblioref">Frey 2022</a>)</span>. Analyses following the release of the 2010 decennial census showed that increasing national diversity resulted in differing neighborhood trajectories, largely contingent on the broader metropolitan context <span class="citation" data-cites="Terbeck2023 Wright2014">(<a href="#ref-Terbeck2023" role="doc-biblioref">Terbeck 2023</a>; <a href="#ref-Wright2014" role="doc-biblioref">Wright et al. 2014</a>)</span>.</p>
<p>Much of the empirical scholarship on neighborhood racial and ethnic changes has developed indices to categorize the makeup or diversity of racial and ethnic groups and then explored changes in a neighborhood’s diversity categorization over time. For example, a neighborhood might transition from ‘low diverse’ to ‘moderately diverse’ from one decade to the next <span class="citation" data-cites="farrell2011racial Wright2014">(<a href="#ref-farrell2011racial" role="doc-biblioref">Farrell and Lee 2011</a>; <a href="#ref-Wright2014" role="doc-biblioref">Wright et al. 2014</a>)</span>. Alternately, another set of techniques aims to describe the longitudinal sequences or trajectories that the racial and ethnic groups in a neighborhood have followed. Two methods have been used for this purpose: statistical curve fitting and sequence analysis. With curve-fitting models like growth mixture models or latent growth models, mathematical functions fit each racial and ethnic group under study that summarize the predominant trends <span class="citation" data-cites="Zwiers2018 HippKim2023">(<a href="#ref-Zwiers2018" role="doc-biblioref">Zwiers, Ham, and Manley 2018</a>; <a href="#ref-HippKim2023" role="doc-biblioref">Hipp and Kim 2023a</a>)</span>. With sequence analysis, neighborhoods are first grouped into similar clusters according to their racial and ethnic makeup using an unsupervised clustering algorithm like k-means. This is done for all neighborhoods and all time stamps. Then, each neighborhood is assigned a categorical cluster over time, and finally, the sequences of these clusters are grouped using a sequence alignment technique <span class="citation" data-cites="Delmelle2016 GonzalezLeonardo2023">(<a href="#ref-Delmelle2016" role="doc-biblioref">Delmelle 2016</a>; <a href="#ref-GonzalezLeonardo2023" role="doc-biblioref">González‐Leonardo, Newsham, and Rowe 2023</a>)</span>. Both methods aim to develop a typology of the predominant longitudinal pathways of change for multiple variables at once.</p>
<p>In this article, we explore trajectories of neighborhood racial and ethnic changes in the largest and one of the most diverse cities in the United States, New York City, using longitudinal census data up to the latest 2020 decennial release. This notebook showcases a workflow that introduces sequence analysis to the study of multidimensional neighborhood changes. We begin by processing the raw longitudinal census data, then performing a k-means classification, and finally classify and map sequences clusters. Our case study illustrates the gradual progression that neighborhoods follow in when undergoing racial and ethnic transformations. We observe an overall decline in the share of neighborhoods categorized by a large White majority population, in exchange for increasing diversity, especially Hispanic and Asian populations.</p>
</section>
<section id="sec-compEnv" class="level2">
<h2 class="anchored" data-anchor-id="sec-compEnv">Computational environment</h2>
<p>The main libraries used in this paper include <code>dplyr</code> for processing tabular census data, <code>sf</code> for mapping the resulting clusters, <code>cluster</code> for performing the <code>k-means</code> cluster analysis. Finally, to perform the sequence analysis, we use <code>TraMineR</code> <span class="citation" data-cites="gabadinho2011analyzing">(<a href="#ref-gabadinho2011analyzing" role="doc-biblioref">Gabadinho et al. 2011</a>)</span>. This is a popular and continually updated R package for performing sequence analysis for a host of social science applications, including analyses of neighborhood change <span class="citation" data-cites="Delmelle2016 delmelle2017differentiating patias2020scalable">(<a href="#ref-Delmelle2016" role="doc-biblioref">Delmelle 2016</a>, <a href="#ref-delmelle2017differentiating" role="doc-biblioref">2017</a>; <a href="#ref-patias2020scalable" role="doc-biblioref">Patias, Rowe, and Cavazzi 2020</a>)</span>.</p>
</section>
<section id="sec-data" class="level2">
<h2 class="anchored" data-anchor-id="sec-data">Data</h2>
<p>We use decennial census tract data to examine neighborhood racial and ethnic changes. Census tracts serve as imperfect, yet well-used neighborhood proxies. Census tract boundaries change over time, further complicating the study of population dynamics within these boundaries. There are several sources of data that have been harmonized using interpolation techniques to a consistent set of boundaries over time. We use the Longitudinal Tract Database (LTDB) which uses areal and population interpolation techniques alongside ancillary data on water cover to derive estimates <span class="citation" data-cites="logan2014interpolating">(<a href="#ref-logan2014interpolating" role="doc-biblioref">Logan, Xu, and Stults 2014</a>)</span>. Analyses of the errors produced by three popular longitudinal data providers suggest that LTDB performs similarly to the dataset produced by the National Historic Geographic Information System (NHGIS) and both perform better than the Neighborhood Change Database which relies solely on areal interpolation without the inclusion of ancillary data <span class="citation" data-cites="logan2014interpolating">(<a href="#ref-logan2014interpolating" role="doc-biblioref">Logan, Xu, and Stults 2014</a>)</span>. Therefore, for this type of analysis either the LTDB or NHGIS would be suitable dataset for this analysis.</p>
<p>We obtained the full count decennial data from LTDB from 1980-2020 from the <a href="https://s4.ad.brown.edu/projects/diversity/Researcher/LTBDDload/DataList.aspx">Diversity and Disparties project at Brown University</a>. The census variables have been interpolated to 2010 tract boundaries. Because the coding of census race and ethnicity changes over time, we opted to begin in 1980 as 1970, the earliest dataset available, did not record a count of Latino or Hispanic residents. The raw data contains all census tracts throughout the United States. For visualization purposes, we also import a shapefile of 2010 census tract boundaries using the <code>tidycensus</code> package and setting the geometry to <code>true</code>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="fu">here</span>())  <span class="co">#current working directory</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">#csv tables for longitudinal data</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>census20<span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/ltdb_std_2020_fullcount.csv"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>census10<span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/LTDB_Std_2010_fullcount.csv"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>census00<span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/LTDB_Std_2000_fullcount.csv"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>census90<span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/LTDB_Std_1990_fullcount.csv"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>census80<span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/LTDB_Std_1980_fullcount.csv"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">#geometry data</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">#filter for NYC counties (5 boroughs)</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>nyc_counties <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Kings"</span>, <span class="st">"Queens"</span>, <span class="st">"New York"</span>, <span class="st">"Richmond"</span>, <span class="st">"Bronx"</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>tract <span class="ot">&lt;-</span> <span class="fu">get_decennial</span>(<span class="at">geography =</span> <span class="st">"tract"</span>,</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>                       <span class="at">variables =</span> <span class="st">"P001001"</span>,</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>                       <span class="at">year =</span> <span class="dv">2010</span>,</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>                       <span class="at">state =</span> <span class="st">"NY"</span>,</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>                       <span class="at">county =</span> nyc_counties,</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>                       <span class="at">geometry =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>                       <span class="at">progress =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We next calculate the share of <code>White</code>, <code>Black</code>, <code>Hispanic</code>, and <code>Asian</code> residents in each tract for each decade from the raw count using the total population as the denominator. We filter out tracts where the population is <code>0</code> and select only the relevant columns to create our data frame. We then join all columns from the five decennial data frames into one data frame called <code>census_all</code> and finally select only census tracts from the five counties that comprise New York City’s five boroughs: Bronx County, Kings County (Brooklyn), New York County (Manhattan), Queens County, Richmond County (Staten Island).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>census80 <span class="ot">&lt;-</span> census80 <span class="sc">%&gt;%</span> <span class="fu">filter</span> (POP80 <span class="sc">&gt;</span><span class="dv">0</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>census80<span class="sc">$</span>perwhite80 <span class="ot">&lt;-</span> census80<span class="sc">$</span>NHWHT80<span class="sc">/</span>census80<span class="sc">$</span>POP80</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>census80<span class="sc">$</span>perblack80 <span class="ot">&lt;-</span> census80<span class="sc">$</span>NHBLK80<span class="sc">/</span>census80<span class="sc">$</span>POP80</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>census80<span class="sc">$</span>perhisp80 <span class="ot">&lt;-</span> census80<span class="sc">$</span>HISP80<span class="sc">/</span>census80<span class="sc">$</span>POP80</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>census80<span class="sc">$</span>perasian80 <span class="ot">&lt;-</span> census80<span class="sc">$</span>ASIAN80<span class="sc">/</span>census80<span class="sc">$</span>POP80</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>census80<span class="ot">&lt;-</span> census80 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"TRTID10"</span>,<span class="st">"perwhite80"</span>, <span class="st">"perblack80"</span>, <span class="st">"perhisp80"</span>, <span class="st">"perasian80"</span>))</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>census90 <span class="ot">&lt;-</span> census90 <span class="sc">%&gt;%</span> <span class="fu">filter</span> (POP90 <span class="sc">&gt;</span><span class="dv">0</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>census90<span class="sc">$</span>perwhite90 <span class="ot">&lt;-</span> census90<span class="sc">$</span>NHWHT90<span class="sc">/</span>census90<span class="sc">$</span>POP90</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>census90<span class="sc">$</span>perblack90 <span class="ot">&lt;-</span> census90<span class="sc">$</span>NHBLK90<span class="sc">/</span>census90<span class="sc">$</span>POP90</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>census90<span class="sc">$</span>perhisp90 <span class="ot">&lt;-</span> census90<span class="sc">$</span>HISP90<span class="sc">/</span>census90<span class="sc">$</span>POP90</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>census90<span class="sc">$</span>perasian90 <span class="ot">&lt;-</span> census90<span class="sc">$</span>ASIAN90<span class="sc">/</span>census90<span class="sc">$</span>POP90</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>census90<span class="ot">&lt;-</span> census90 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"TRTID10"</span>,<span class="st">"state"</span>,<span class="st">"county"</span>,<span class="st">"perwhite90"</span>, <span class="st">"perblack90"</span>, <span class="st">"perhisp90"</span>, <span class="st">"perasian90"</span>))</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>census00 <span class="ot">&lt;-</span> census00 <span class="sc">%&gt;%</span> <span class="fu">filter</span> (POP00 <span class="sc">&gt;</span><span class="dv">0</span>)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>census00<span class="sc">$</span>perwhite00 <span class="ot">&lt;-</span> census00<span class="sc">$</span>NHWHT00<span class="sc">/</span>census00<span class="sc">$</span>POP00</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>census00<span class="sc">$</span>perblack00 <span class="ot">&lt;-</span> census00<span class="sc">$</span>NHBLK00<span class="sc">/</span>census00<span class="sc">$</span>POP00</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>census00<span class="sc">$</span>perhisp00 <span class="ot">&lt;-</span> census00<span class="sc">$</span>HISP00<span class="sc">/</span>census00<span class="sc">$</span>POP00</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>census00<span class="sc">$</span>perasian00 <span class="ot">&lt;-</span> census00<span class="sc">$</span>ASIAN00<span class="sc">/</span>census00<span class="sc">$</span>POP00</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>census00<span class="ot">&lt;-</span> census00 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"TRTID10"</span>,<span class="st">"perwhite00"</span>, <span class="st">"perblack00"</span>, <span class="st">"perhisp00"</span>, <span class="st">"perasian00"</span>))</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>census10 <span class="ot">&lt;-</span> census10 <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="st">"TRTID10"</span> <span class="ot">=</span> <span class="st">"tractid"</span>)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>census10<span class="sc">$</span>perwhite10 <span class="ot">&lt;-</span> census10<span class="sc">$</span>nhwht10<span class="sc">/</span>census10<span class="sc">$</span>pop10</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>census10<span class="sc">$</span>perblack10 <span class="ot">&lt;-</span> census10<span class="sc">$</span>nhblk10<span class="sc">/</span>census10<span class="sc">$</span>pop10</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>census10<span class="sc">$</span>perhisp10 <span class="ot">&lt;-</span> census10<span class="sc">$</span>hisp10<span class="sc">/</span>census10<span class="sc">$</span>pop10</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>census10<span class="sc">$</span>perasian10 <span class="ot">&lt;-</span> census10<span class="sc">$</span>asian10<span class="sc">/</span>census10<span class="sc">$</span>pop10</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>census10<span class="ot">&lt;-</span> census10 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"TRTID10"</span>,<span class="st">"perwhite10"</span>, <span class="st">"perblack10"</span>, <span class="st">"perhisp10"</span>, <span class="st">"perasian10"</span>))</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>census20 <span class="ot">&lt;-</span> census20 <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="st">"TRTID10"</span> <span class="ot">=</span> <span class="st">"TRTID2010"</span>)</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>census20<span class="sc">$</span>perwhite20 <span class="ot">&lt;-</span> census20<span class="sc">$</span>nhwt20<span class="sc">/</span>census20<span class="sc">$</span>pop20</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>census20<span class="sc">$</span>perblack20 <span class="ot">&lt;-</span> census20<span class="sc">$</span>nhblk20<span class="sc">/</span>census20<span class="sc">$</span>pop20</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>census20<span class="sc">$</span>perhisp20 <span class="ot">&lt;-</span> census20<span class="sc">$</span>hisp20<span class="sc">/</span>census20<span class="sc">$</span>pop20</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>census20<span class="sc">$</span>perasian20 <span class="ot">&lt;-</span> census20<span class="sc">$</span>asian20<span class="sc">/</span>census20<span class="sc">$</span>pop20</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>census20<span class="ot">&lt;-</span> census20 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"TRTID10"</span>,<span class="st">"perwhite20"</span>, <span class="st">"perblack20"</span>, <span class="st">"perhisp20"</span>, <span class="st">"perasian20"</span>))</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="co">#join all data frames from each decade</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>census_all<span class="ot">&lt;-</span> census90 <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(census00) <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(., census10) <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(., census20)<span class="sc">%&gt;%</span> <span class="fu">left_join</span>(., census80)</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="co">#Select NYC Counties. These include Bronx County, Kings County (Brooklyn), New York County (Manhattan), Queens County, Richmond County (Staten Island)</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>census_select <span class="ot">&lt;-</span> census_all <span class="sc">%&gt;%</span> <span class="fu">filter</span>((state <span class="sc">==</span> <span class="st">"NY"</span> <span class="sc">&amp;</span> county <span class="sc">==</span> <span class="st">"Bronx County"</span>)<span class="sc">|</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>                              (state <span class="sc">==</span> <span class="st">"NY"</span> <span class="sc">&amp;</span> county <span class="sc">==</span> <span class="st">"Kings County"</span>)<span class="sc">|</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>                              (state <span class="sc">==</span> <span class="st">"NY"</span> <span class="sc">&amp;</span> county <span class="sc">==</span> <span class="st">"New York County"</span>)<span class="sc">|</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>                              (state <span class="sc">==</span> <span class="st">"NY"</span> <span class="sc">&amp;</span> county <span class="sc">==</span> <span class="st">"Queens County"</span>)<span class="sc">|</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>                              (state <span class="sc">==</span> <span class="st">"NY"</span> <span class="sc">&amp;</span> county <span class="sc">==</span> <span class="st">"Richmond County"</span>))</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a><span class="do">##remove NA values and state and county columns</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>census_nyc <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(census_select)<span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>state, <span class="sc">-</span>county)</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a><span class="co">#Select only the tractID column from the shapefile. Rename the field for ease of joining and convert to double to match the csv data.</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>tract<span class="ot">&lt;-</span> tract <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="st">"GEOID"</span>)</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>tract<span class="ot">&lt;-</span> <span class="fu">rename</span>(tract, <span class="at">TRTID10 =</span> GEOID)</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>tract<span class="sc">$</span>TRTID10<span class="ot">&lt;-</span> <span class="fu">as.double</span>(tract<span class="sc">$</span>TRTID10)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set tigris options to return the data in sf format (spatial data frame)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">tigris_class =</span> <span class="st">"sf"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Download county boundaries for New York state</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>ny_counties <span class="ot">&lt;-</span> <span class="fu">counties</span>(<span class="at">state =</span> <span class="st">"NY"</span>, <span class="at">cb =</span> <span class="cn">TRUE</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">progress =</span> <span class="cn">FALSE</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for only the New York City counties</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>nyc_counties <span class="ot">&lt;-</span> ny_counties <span class="sc">%&gt;%</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Bronx"</span>, <span class="st">"Kings"</span>, <span class="st">"New York"</span>, <span class="st">"Queens"</span>, <span class="st">"Richmond"</span>))</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co"># View the structure of the data</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(nyc_counties)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 5 features and 12 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -74.25563 ymin: 40.4961 xmax: -73.70036 ymax: 40.91771
Geodetic CRS:  NAD83
  STATEFP COUNTYFP COUNTYNS       AFFGEOID GEOID     NAME        NAMELSAD
1      36      061 00974129 0500000US36061 36061 New York New York County
2      36      047 00974122 0500000US36047 36047    Kings    Kings County
3      36      081 00974139 0500000US36081 36081   Queens   Queens County
4      36      085 00974141 0500000US36085 36085 Richmond Richmond County
5      36      005 00974101 0500000US36005 36005    Bronx    Bronx County
  STUSPS STATE_NAME LSAD     ALAND    AWATER                       geometry
1     NY   New York   06  58683880  29010416 MULTIPOLYGON (((-74.00641 4...
2     NY   New York   06 179684484  71158757 MULTIPOLYGON (((-74.04171 4...
3     NY   New York   06 281594048 188444349 MULTIPOLYGON (((-73.96262 4...
4     NY   New York   06 148982680 117441532 MULTIPOLYGON (((-74.16154 4...
5     NY   New York   06 109235674  39353304 MULTIPOLYGON (((-73.77242 4...</code></pre>
</div>
</div>
</section>
<section id="sec-intuition" class="level2">
<h2 class="anchored" data-anchor-id="sec-intuition">Basic conceptual intuition</h2>
<p>Our analysis features two fundamental steps. The first is the <em>k</em>-means clustering of the census tracts to derive multidimensional classes of neighborhoods containing similar racial and ethnic compositions. <span class="citation" data-cites="reibel2011neighborhood">(<a href="#ref-reibel2011neighborhood" role="doc-biblioref">Reibel and Regelson 2011</a>)</span> introduced the idea of using an unsupervised classification approach for studying neighborhood racial change as an alternative to the use of neighborhood diversity indices. The objective of the <em>k</em>-means algorithm is to group observations in such a way that maximizes the similarity of observations within groups or clusters while maximizing the dissimilarity between each cluster. In other words, the goal is to group neighborhoods so that those most similar to each other according to their racial and ethnic makeup are assigned to the same cluster and the clusters themselves are distinct from one another in terms of their makeup. With the <em>k</em>-means algorithm, the number of clusters, <em>k</em> must be determined <em>a priori</em>. To make this determination, it is customary to evaluate multiple solutions using various fit statistics in conjunction with domain and geographic knowledge of the data <span class="citation" data-cites="delmelle2015five">(<a href="#ref-delmelle2015five" role="doc-biblioref">Delmelle 2015</a>)</span>. It is also commonly recommended that input variables first be normalized to avoid placing unequal emphasis on variables that may be on different measurement scales. However, in our case study, all of the racial and ethnic variables represent percentages of the population and so this step is not performed in the case study.</p>
<p>Our ultimate goal is to understand the major pathways of neighborhood change and so each neighborhood will be classified five times for 1980, 1990, 2000, 2010, and 2020 to establish its longitudinal sequence. To ensure that the clusters are temporally stable, we will perform the clustering for all years at once. New neighborhood typologies may emerge over time with this approach. In that instance, only tracts from the later years would be assigned to the new cluster.</p>
<p>Like <em>k</em>-means, sequence analysis is an unsupervised classification technique that aims to cluster similar longitudinal sequences. To determine the similarity of the sequences, a key step in this analysis is to create the dissimilarity measure. There are various approaches that can be used to determine the similarity of categorical sequences. <span class="citation" data-cites="studer2016matters">(<a href="#ref-studer2016matters" role="doc-biblioref">Studer and Ritschard 2016</a>)</span> provides a comprehensive overview of various techniques for determining sequences dissimilarity for social science applications. In this case study, we are most interested in the <em>ordering</em> or <em>sequencing</em> of neighborhood cross-sectional racial groups. Each neighborhood will have the same number of states, captured at the same decennial interval, which differs from studies of individuals progressing through a series of life course events, for example. In those cases, other considerations like the duration of time spent in each state or the timing of certain events may matter more in ultimately grouping the sequences based on similarity. Here we aim to create clusters of sequences that follow a similar ordering of events - progressing from example, a Majority White neighborhood through a Mixed Race state towards a Majority Hispanic state. The amount of time spent in each of these states might differ, but ultimately this describes <em>how</em> a neighborhood has changed over time. Given this, we follow <span class="citation" data-cites="delmelle2017differentiating">(<a href="#ref-delmelle2017differentiating" role="doc-biblioref">Delmelle 2017</a>)</span> and use a variation on the popular Optimal Matching (OM) algorithm called OMstrans. The OM algorithm is a string editing technique that determines the cost it would take to completely transform one sequence into another. This is achieved by either inserting, deleting, or substituting elements in one sequence until it matches another. For example, one neighborhood may have a sequence of <em>White</em>, <em>White</em>, <em>Mixed Race</em>, <em>Hispanic</em> while another neighborhood might follow the sequence <em>White</em>, <em>White</em>, <em>Mixed Race</em>, <em>Mixed Race</em>. Between these two strings, there is one entry that differs: the final state. To transform one to another, we could substitute <em>Hispanic</em> for <em>Mixed Race</em> in the second sequence, and the dissimilarity of the two sequences would be equal to the cost of that substitution. In the OMstrans variant, distances between sequences of transitions are computed. This means that each state is merged with its previous state to create a subsequence. In the previous illustrative example, the first sequence becomes (<em>White-White</em>, <em>White-MixedRace</em>, <em>MixedRace-Hispanic</em>) and the OM cost evaluation is then applied to these subsequences. This helps to ensure that the ordering of events is preserved in the sequence clusters. The importance given to the preservation of ordering is governed by the parameter <em>w</em>, the origin-transition parameter. When <em>w</em> = 1, OMstrans approximates the traditional OM algorithm. A lower value places greater emphasis on the ordering or sequencing of events.</p>
</section>
<section id="sec-application" class="level2">
<h2 class="anchored" data-anchor-id="sec-application">Application</h2>
<section id="study-area" class="level3">
<h3 class="anchored" data-anchor-id="study-area">Study Area</h3>
<p>Our study area consists of census tracts within the five Boroughs of New York (see Figure below for an overview map).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for only the New York City counties</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>nyc_counties <span class="ot">&lt;-</span> ny_counties <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Bronx"</span>, <span class="st">"Kings"</span>, <span class="st">"New York"</span>, <span class="st">"Queens"</span>, <span class="st">"Richmond"</span>)) </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Modify labels for specific counties</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>nyc_counties<span class="sc">$</span>label_main <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(nyc_counties<span class="sc">$</span>NAME <span class="sc">==</span> <span class="st">"New York"</span>, <span class="st">"New York"</span>, </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">ifelse</span>(nyc_counties<span class="sc">$</span>NAME <span class="sc">==</span> <span class="st">"Kings"</span>, <span class="st">"Kings"</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>                                         <span class="fu">ifelse</span>(nyc_counties<span class="sc">$</span>NAME <span class="sc">==</span> <span class="st">"Richmond"</span>, <span class="st">"Richmond"</span>, </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>                                                nyc_counties<span class="sc">$</span>NAME)))</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>nyc_counties<span class="sc">$</span>label_paren <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(nyc_counties<span class="sc">$</span>NAME <span class="sc">==</span> <span class="st">"New York"</span>, <span class="st">"(Manhattan)"</span>, </span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">ifelse</span>(nyc_counties<span class="sc">$</span>NAME <span class="sc">==</span> <span class="st">"Kings"</span>, <span class="st">"(Brooklyn)"</span>,</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>                                          <span class="fu">ifelse</span>(nyc_counties<span class="sc">$</span>NAME <span class="sc">==</span> <span class="st">"Richmond"</span>, <span class="st">"(Staten Island)"</span>, </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>                                                 <span class="st">""</span>)))</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate centroids for each county to get coordinates for labels</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>centroids <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(nyc_counties)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(centroids)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the coordinates to the nyc_counties data frame</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>nyc_counties <span class="ot">&lt;-</span> nyc_counties <span class="sc">%&gt;%</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">X =</span> coords[, <span class="dv">1</span>],</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">Y =</span> coords[, <span class="dv">2</span>])</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust coordinates manually for specific counties</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>nyc_counties <span class="ot">&lt;-</span> nyc_counties <span class="sc">%&gt;%</span> </span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">X =</span> <span class="fu">ifelse</span>(NAME <span class="sc">==</span> <span class="st">"New York"</span>, X <span class="sc">-</span> <span class="fl">0.11</span>, </span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>               <span class="fu">ifelse</span>(NAME <span class="sc">==</span> <span class="st">"Richmond"</span>, X <span class="sc">+</span> <span class="fl">0.012</span>, X)), <span class="co"># Move "New York" left, Richmond right</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">Y =</span> <span class="fu">ifelse</span>(NAME <span class="sc">==</span> <span class="st">"New York"</span>, Y <span class="sc">+</span> <span class="fl">0.005</span>, </span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>               <span class="fu">ifelse</span>(NAME <span class="sc">==</span> <span class="st">"Richmond"</span>, Y <span class="sc">+</span> <span class="fl">0.03</span>, Y)) <span class="co"># Adjust Richmond label higher</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a><span class="co">#you can mask water area if you would like.</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a><span class="co">#nyc_counties &lt;- nyc_counties %&gt;%  erase_water(area_threshold = 0.9)</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the large map for the state without a scale bar</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>zoomed_map <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ny_counties, <span class="at">fill =</span> <span class="st">"gray85"</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="co"># New York State outline</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> nyc_counties, <span class="at">fill =</span> <span class="st">"#85B0A9"</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> <span class="co"># NYC counties in teal</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="sc">-</span><span class="fl">73.98</span>, <span class="at">y =</span> <span class="fl">40.775</span>, <span class="at">xend =</span> <span class="sc">-</span><span class="fl">74.03</span>, <span class="at">yend =</span> <span class="fl">40.775</span>), </span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"gray25"</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span> <span class="co"># Line from New York label to the boundary</span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> nyc_counties, <span class="fu">aes</span>(<span class="at">x =</span> X, <span class="at">y =</span> Y, <span class="at">label =</span> label_main), </span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">family =</span> <span class="st">"Arial"</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span> <span class="co"># Add main county names</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> nyc_counties, <span class="fu">aes</span>(<span class="at">x =</span> X, <span class="at">y =</span> Y <span class="sc">-</span> <span class="fl">0.02</span>, <span class="at">label =</span> label_paren), </span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"gray25"</span>, <span class="at">size =</span> <span class="fl">3.75</span>, <span class="at">family =</span> <span class="st">"Arial"</span>) <span class="sc">+</span> <span class="co"># Add parentheses labels in lighter color</span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="sc">-</span><span class="fl">73.6</span>, <span class="at">y =</span> <span class="fl">40.725</span>, <span class="at">label =</span> <span class="st">"Nassau"</span>), </span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"gray55"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">family =</span> <span class="st">"Arial"</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span> <span class="co"># Corrected Nassau label position</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="sc">-</span><span class="fl">73.8</span>, <span class="at">y =</span> <span class="fl">40.98</span>, <span class="at">label =</span> <span class="st">"Westchester"</span>), </span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"gray55"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">family =</span> <span class="st">"Arial"</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span> <span class="co"># Corrected Westchester label</span></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="sc">-</span><span class="fl">73.6</span>, <span class="at">y =</span> <span class="fl">40.705</span>, <span class="at">label =</span> <span class="st">"(Long Island)"</span>), </span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"gray70"</span>, <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">family =</span> <span class="st">"Arial"</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span> <span class="co"># Add Long Island label below Nassau</span></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">74.25</span>, <span class="sc">-</span><span class="fl">73.5</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">40.4</span>, <span class="fl">41.05</span>), <span class="at">expand =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="co"># Crop to focus on NYC</span></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(), <span class="co"># Remove major grid lines</span></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(), <span class="co"># Remove minor grid lines</span></span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_blank</span>(), <span class="co"># Remove axis titles</span></span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_blank</span>(), <span class="co"># Remove axis text (labels)</span></span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>, <span class="co"># Remove the legend</span></span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>) <span class="co"># Remove margins for a tighter crop</span></span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the large map for NY and surrounding counties with text annotation</span></span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>inset_map <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ny_counties, <span class="at">fill =</span> <span class="st">"gray90"</span>, <span class="at">color =</span> <span class="cn">NA</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="co"># All counties in gray, including Nassau and Westchester</span></span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> nyc_counties, <span class="at">fill =</span> <span class="st">"#569289"</span>, <span class="at">color =</span> <span class="st">"#569289"</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span> <span class="co"># NYC counties in darker teal</span></span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="sc">-</span><span class="fl">76.2</span>, <span class="at">y =</span> <span class="fl">42.8</span>, <span class="at">label =</span> <span class="st">"New York State"</span>, </span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="fl">5.25</span>, <span class="at">color =</span> <span class="st">"gray49"</span>, <span class="at">angle =</span> <span class="dv">0</span>, </span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">family =</span> <span class="st">"Arial"</span>) <span class="sc">+</span> <span class="co"># Add text label</span></span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(), <span class="co"># Remove major grid lines</span></span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(), <span class="co"># Remove minor grid lines</span></span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>), <span class="co"># Align title to the left</span></span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>), <span class="co"># Align subtitle to the left</span></span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_blank</span>(), <span class="co"># Remove axis titles</span></span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_blank</span>(), <span class="co"># Remove axis text (labels)</span></span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>) <span class="co"># Tighten margins</span></span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the maps, placing the inset map within the zoomed-in map</span></span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a>final_plot <span class="ot">&lt;-</span> <span class="fu">ggdraw</span>() <span class="sc">+</span></span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">draw_plot</span>(zoomed_map) <span class="sc">+</span></span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">draw_plot</span>(inset_map, <span class="at">x =</span> <span class="fl">0.07</span>, <span class="at">y =</span> <span class="fl">0.65</span>, <span class="at">width =</span> <span class="fl">0.3</span>, <span class="at">height =</span> <span class="fl">0.3</span>) <span class="co"># Adjust position and size of the inset</span></span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the combined plot</span></span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(final_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/visualize-area-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption class="figure-caption">Overview map of New York City’s five boroughs and surrounding counties</figcaption>
</figure>
</div>
</div>
</div>
<p>To begin our case study, we start by preparing the data for the <em>k</em>-means clustering. This involves pivoting the data frame so that each census tract is represented with five distinct rows, once for each decennial value. To do so, we pivot from a wide to a long format and select out just the four race and ethnicity values to be used in the clustering.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the data frame from wide to long format</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>census_long <span class="ot">&lt;-</span> census_nyc <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"per"</span>), </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">".value"</span>, <span class="st">"year"</span>), </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_pattern =</span> <span class="st">"per(</span><span class="sc">\\</span><span class="st">w+)(</span><span class="sc">\\</span><span class="st">d{2})"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">==</span> <span class="st">"80"</span> <span class="sc">~</span> <span class="dv">1980</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">==</span> <span class="st">"90"</span> <span class="sc">~</span> <span class="dv">1990</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">==</span> <span class="st">"00"</span> <span class="sc">~</span> <span class="dv">2000</span>,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">==</span> <span class="st">"10"</span> <span class="sc">~</span> <span class="dv">2010</span>,</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">==</span> <span class="st">"20"</span> <span class="sc">~</span> <span class="dv">2020</span>,</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as.integer</span>(year)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>data_for_clustering <span class="ot">&lt;-</span> census_long <span class="sc">%&gt;%</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(white, black, hisp, asian)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>As explained above, the <em>k</em>-means clustering procedure requires that the number of clusters, <em>k</em> be specified <em>a priori</em>. There are fit statistics that attempt to determine the optimal number of clusters, considering the similarity of observations within each cluster and the distinctiveness of the clusters from each other. However, these mathematically-derived solutions are devoid of any contextual or theoretical understanding of the problem under study. Therefore, the selection of <em>k</em> often becomes more akin to art than a science <span class="citation" data-cites="von2012clustering">(<a href="#ref-von2012clustering" role="doc-biblioref">Von Luxburg, Williamson, and Guyon 2012</a>)</span>, considering the objective of the study. We begin with two common data-driven approaches that explore multiple clustering solutions for different <em>k</em> values and then examines the <em>within sum of squares</em> (WSS) and the <em>average silhouette score</em> for each solution. The WSS assesses how compact a clustering solution is, or how homogeneous the observations assigned to each cluster are, and the average silhouette score measures how well separated each cluster is from each other. Our objective is to derive a typology of neighborhoods according to their racial and ethnic makeup, for four groups: percent White, Black, Hispanic, and Asian. The Figure below shows the results of the clustering analysis: (a) the Elbow method plot suggests the optimal number of clusters, and (b) the Silhouette method plot helps validate the cluster separation.</p>
<div class="cell" data-fig.label="clustering-analysis">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now do the k-means clustering on all</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>data_for_clustering <span class="ot">&lt;-</span> census_long <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(white, black, hisp, asian)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to calculate total within-cluster sum of squares for different k</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>wss <span class="ot">&lt;-</span> <span class="cf">function</span>(k) {</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kmeans</span>(data_for_clustering, k, <span class="at">nstart =</span> <span class="dv">10</span>)<span class="sc">$</span>tot.withinss</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute and plot wss for k = 1 to k = 10</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>k.values <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>wss_values <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(k.values, wss)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Elbow method plot</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(k.values, wss_values, <span class="at">type =</span> <span class="st">"b"</span>, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">frame =</span> <span class="cn">FALSE</span>,</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Number of clusters K"</span>,</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Total within-clusters sum of squares"</span>)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Silhouette method for determining the optimal number of clusters</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_nbclust</span>(data_for_clustering, kmeans, <span class="at">method =</span> <span class="st">"silhouette"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/kmeans1-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">(a) Elbow method plot</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/kmeans1-2.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">(b) Silhouette method plot</figcaption>
</figure>
</div>
</div>
<p>Clustering Analysis: (a) Elbow method plot, (b) Silhouette method plot.</p>
</div>
</section>
<section id="exploring-k-means-cluster-solutions" class="level3">
<h3 class="anchored" data-anchor-id="exploring-k-means-cluster-solutions">Exploring <em>k</em>-means Cluster Solutions</h3>
<p>According to these plots, the mathematically optimal number of neighborhood clusters for racial makeup is three. We can further explore the makeup of neighborhoods within these three clusters a few ways to determine if, in fact, three clusters provides a meaningful segmentation of four distinct racial and ethnic groups. In the plots below, we can visualize the average silhouette value for each cluster. The <em>Silhouette</em> values range from -1 to 1; values close to 1 suggest that the observations are well clustered while negative values suggest that an observation might be assigned to the wrong cluster. From the plot, Clusters 2 and 3 appears to be the most cohesive clusters, with average silhouette widths of 0.64, while cluster 1 has some potentially poorly classified neighborhoods. Descriptions of the racial and ethnic makeup of the clusters are obtained from the associated stacked bar charts. We can see that Cluster 1 is characterized as being nearly 50 percent Hispanic, with near equal shares of Whites, Blacks, and Asians. Cluster 2 is majority Black with approximately 15 percent Hispanics and few Whites and Asians. Finally, Cluster 3 is majority White. Therefore, this segmentation provides us with clusters indicating the dominant racial groups, but may miss some nuances of other racial and ethnic neighborhood compositions. We can therefore explore how increasing <em>k</em> may portray a richer portrait of neighborhood demographic profiles. In the Figure below, (a) illustrates the Silhouette Analysis to assess cluster separation, and (b) depicts the demographic makeup of the three clusters.</p>
<div class="cell" data-fig.label="three-clusters">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assume the optimal number of clusters (k) is 3 from the previous steps</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>kmeans_result <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(data_for_clustering, <span class="at">centers =</span> <span class="dv">3</span>, <span class="at">nstart =</span> <span class="dv">25</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the cluster assignments to the original data</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>census_long<span class="sc">$</span>cluster <span class="ot">&lt;-</span> kmeans_result<span class="sc">$</span>cluster</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Silhouette Analysis</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>sil <span class="ot">&lt;-</span> <span class="fu">silhouette</span>(kmeans_result<span class="sc">$</span>cluster, <span class="fu">dist</span>(data_for_clustering))</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_silhouette</span>(sil)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  cluster size ave.sil.width
1       1 3284          0.33
2       2 2478          0.64
3       3 4848          0.64</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract silhouette information to a data frame (df)</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>sil_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(sil[, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(sil_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Cluster"</span>, <span class="st">"Silhouette Width"</span>, <span class="st">"Neighboring Cluster"</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Cluster profiles</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>cluster_profiles <span class="ot">&lt;-</span> census_long <span class="sc">%&gt;%</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cluster) <span class="sc">%&gt;%</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">c</span>(white, black, hisp, asian), <span class="sc">~</span> <span class="fu">round</span>(<span class="fu">mean</span>(.), <span class="dv">2</span>)))</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the table as a formatted table</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(cluster_profiles, <span class="at">caption =</span> <span class="st">"Cluster Profiles: Average Demographics"</span>, </span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Cluster"</span>, <span class="st">"White"</span>, <span class="st">"Black"</span>, <span class="st">"Hispanic"</span>, <span class="st">"Asian"</span>),</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">format =</span> <span class="st">"markdown"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Cluster Profiles: Average Demographics</caption>
<thead>
<tr class="header">
<th style="text-align: right;">Cluster</th>
<th style="text-align: right;">White</th>
<th style="text-align: right;">Black</th>
<th style="text-align: right;">Hispanic</th>
<th style="text-align: right;">Asian</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.15</td>
<td style="text-align: right;">0.18</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">0.15</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.75</td>
<td style="text-align: right;">0.14</td>
<td style="text-align: right;">0.02</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.73</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">0.10</td>
</tr>
</tbody>
</table>
<ol type="a">
<li>Silhouette Analysis</li>
</ol>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape the data from wide to long format</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>cluster_profiles_long <span class="ot">&lt;-</span> cluster_profiles <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"white"</span>, <span class="st">"black"</span>, <span class="st">"hisp"</span>, <span class="st">"asian"</span>), </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"Demographic"</span>, <span class="at">values_to =</span> <span class="st">"Proportion"</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the stacked bar chart</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cluster_profiles_long, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(cluster), <span class="at">y =</span> Proportion, <span class="at">fill =</span> Demographic)) <span class="sc">+</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Cluster Demographic Makeup - 3 clusters"</span>, <span class="at">x =</span> <span class="st">"Cluster"</span>, <span class="at">y =</span> <span class="st">"Proportion"</span>) <span class="sc">+</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Set3"</span>) <span class="sc">+</span>  <span class="co"># Adjust color palette if desired</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/threeclusters-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">(a) Silhouette Analysis</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/threeclusters-2.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">(b) Cluster Demographic Makeup</figcaption>
</figure>
</div>
</div>
<p>Cluster Analysis Results: (a) Silhouette Analysis and (b) Cluster Demographic Makeup.</p>
</div>
<p>Next, we compare 4, 5, and 6 cluster solutions. We can see that the average silhouette of the solutions declines as the number of clusters increases. The demographic profiles show several new neighborhood typologies emerge with more clusters added. With a four cluster solution, we observe neighborhood typologies for each of the three dominant racial and ethic groups: White, Hispanic, and Black along with one mixed neighborhood type, shown in cluster 4. As expected, that cluster displays the lowest silhouette value, with some potentially mis-classified neighborhoods. The 5 cluster solution adds a cluster showing a majority Asian population, alongside two majority White populations - one showing more diversity than the other), and a majority Black, and Hispanic group. Finally, a 6 cluster solution shows more racially mixed groups, but at the expense of less well-defined or separated clusters. In the code below, each variable name ends with a number (4, 5 or 6), indicating which number of clusters (k) it represents. The results displays the silhouette analysis results for clustering into (a) four clusters, (b) five clusters, and (c) six clusters, illustrating the cohesion and separation of clusters at different sizes.</p>
<div class="cell" data-fig.label="silhouette-analysis">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform k-means clustering for 4, 5, and 6 clusters</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>kmeans_4 <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(data_for_clustering, <span class="at">centers =</span> <span class="dv">4</span>, <span class="at">nstart =</span> <span class="dv">25</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>kmeans_5 <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(data_for_clustering, <span class="at">centers =</span> <span class="dv">5</span>, <span class="at">nstart =</span> <span class="dv">25</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>kmeans_6 <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(data_for_clustering, <span class="at">centers =</span> <span class="dv">6</span>, <span class="at">nstart =</span> <span class="dv">25</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Add cluster assignment to original data</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>census_long<span class="sc">$</span>cluster_4 <span class="ot">&lt;-</span> kmeans_4<span class="sc">$</span>cluster</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>census_long<span class="sc">$</span>cluster_5 <span class="ot">&lt;-</span> kmeans_5<span class="sc">$</span>cluster</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>census_long<span class="sc">$</span>cluster_6 <span class="ot">&lt;-</span> kmeans_6<span class="sc">$</span>cluster</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Silhouette analysis for 4, 5, and 6 clusters</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>sil_4 <span class="ot">&lt;-</span> <span class="fu">silhouette</span>(kmeans_4<span class="sc">$</span>cluster, <span class="fu">dist</span>(data_for_clustering))</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>sil_5 <span class="ot">&lt;-</span> <span class="fu">silhouette</span>(kmeans_5<span class="sc">$</span>cluster, <span class="fu">dist</span>(data_for_clustering))</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>sil_6 <span class="ot">&lt;-</span> <span class="fu">silhouette</span>(kmeans_6<span class="sc">$</span>cluster, <span class="fu">dist</span>(data_for_clustering))</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot silhouette for 4 clusters</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>plot_4 <span class="ot">&lt;-</span> <span class="fu">fviz_silhouette</span>(sil_4) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Silhouette Plot - Four Clusters"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  cluster size ave.sil.width
1       1 2091          0.49
2       2 2431          0.64
3       3 2265          0.20
4       4 3823          0.64</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot silhouette for 5 clusters</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>plot_5 <span class="ot">&lt;-</span> <span class="fu">fviz_silhouette</span>(sil_5) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Silhouette Plot - Five Clusters"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  cluster size ave.sil.width
1       1 2130          0.48
2       2 3002          0.64
3       3  870          0.33
4       4 2417          0.64
5       5 2191          0.24</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot silhouette for 6 clusters</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>plot_6 <span class="ot">&lt;-</span> <span class="fu">fviz_silhouette</span>(sil_6) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Silhouette Plot - Six Clusters"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  cluster size ave.sil.width
1       1 1667          0.68
2       2 2152          0.27
3       3  843          0.34
4       4 2903          0.63
5       5 1246          0.26
6       6 1799          0.46</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the three plots into a faceted view</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(plot_4, plot_5, plot_6, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/silhouette-plots-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">(a) Four Clusters</figcaption>
</figure>
</div>
</div>
<p>Silhouette Analysis for Different Cluster Sizes: (a) Four Clusters, (b) Five Clusters, and (c) Six Clusters.</p>
</div>
<p>The figure illustrates the demographic composition of clusters for different clustering solutions: (a) four clusters, (b) five clusters, and (c) six clusters, highlighting how demographic groups are distributed across various cluster labels.</p>
<div class="cell" data-fig.label="demographic-makeup">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We need to hard code the labels to be able to compare the demographic profile of each solution. This is because R randomly assigns the label each time, even if the clustering solution is the same because we set the seed.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>label_clusters <span class="ot">&lt;-</span> <span class="cf">function</span>(cluster_profiles) {</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  cluster_profiles <span class="sc">%&gt;%</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">label =</span> <span class="fu">case_when</span>(</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>        white <span class="sc">&gt;</span> <span class="fl">0.75</span> <span class="sc">~</span> <span class="st">"3 White"</span>,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>        hisp <span class="sc">&gt;</span> <span class="fl">0.45</span> <span class="sc">~</span> <span class="st">"2 Hispanic"</span>,</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>        black <span class="sc">&gt;</span> <span class="fl">0.75</span> <span class="sc">~</span> <span class="st">"1 Black"</span>,</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>        asian <span class="sc">&gt;</span> <span class="fl">0.45</span> <span class="sc">~</span> <span class="st">"5 Asian"</span>,</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>        white <span class="sc">&lt;</span> <span class="fl">0.56</span> <span class="sc">&amp;</span> hisp <span class="sc">&gt;</span> <span class="fl">0.20</span> <span class="sc">&amp;</span> black <span class="sc">&lt;</span> <span class="fl">0.20</span> <span class="sc">~</span> <span class="st">"4 Mixed"</span>,</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>        black <span class="sc">&gt;</span> <span class="fl">0.49</span> <span class="sc">&amp;</span> hisp <span class="sc">&gt;</span> <span class="fl">0.25</span> <span class="sc">&amp;</span> white <span class="sc">&lt;</span> <span class="fl">0.15</span> <span class="sc">~</span> <span class="st">"6 Black and Hispanic"</span>,</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Other"</span>  <span class="co"># Default label if none of the conditions are met</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Create cluster profiles and label them according to your custom rules</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>cluster_profiles_4 <span class="ot">&lt;-</span> census_long <span class="sc">%&gt;%</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cluster_4) <span class="sc">%&gt;%</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">c</span>(white, black, hisp, asian), <span class="sc">~</span> <span class="fu">round</span>(<span class="fu">mean</span>(.), <span class="dv">2</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Clustering_Solution</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"4 Clusters"</span>, <span class="at">Cluster =</span> cluster_4) <span class="sc">%&gt;%</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">label_clusters</span>()</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>cluster_profiles_5 <span class="ot">&lt;-</span> census_long <span class="sc">%&gt;%</span></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cluster_5) <span class="sc">%&gt;%</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">c</span>(white, black, hisp, asian), <span class="sc">~</span> <span class="fu">round</span>(<span class="fu">mean</span>(.), <span class="dv">2</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Clustering_Solution</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"5 Clusters"</span>, <span class="at">Cluster =</span> cluster_5) <span class="sc">%&gt;%</span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">label_clusters</span>()</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>cluster_profiles_6 <span class="ot">&lt;-</span> census_long <span class="sc">%&gt;%</span></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cluster_6) <span class="sc">%&gt;%</span></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">c</span>(white, black, hisp, asian), <span class="sc">~</span> <span class="fu">round</span>(<span class="fu">mean</span>(.), <span class="dv">2</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Clustering_Solution</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"6 Clusters"</span>, <span class="at">Cluster =</span> cluster_6) <span class="sc">%&gt;%</span></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">label_clusters</span>()</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine all cluster profiles into one table</span></span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>cluster_profiles_combined <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(cluster_profiles_4, cluster_profiles_5, cluster_profiles_6)</span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Map the labels back to the original tracts by joining based on cluster assignments</span></span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>census_long <span class="ot">&lt;-</span> census_long <span class="sc">%&gt;%</span></span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(cluster_profiles_4 <span class="sc">%&gt;%</span> <span class="fu">select</span>(Cluster, label) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">label_4 =</span> label), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"cluster_4"</span> <span class="ot">=</span> <span class="st">"Cluster"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(cluster_profiles_5 <span class="sc">%&gt;%</span> <span class="fu">select</span>(Cluster, label) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">label_5 =</span> label), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"cluster_5"</span> <span class="ot">=</span> <span class="st">"Cluster"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(cluster_profiles_6 <span class="sc">%&gt;%</span> <span class="fu">select</span>(Cluster, label) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">label_6 =</span> label), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"cluster_6"</span> <span class="ot">=</span> <span class="st">"Cluster"</span>))</span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape data for plotting</span></span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>cluster_profiles_long <span class="ot">&lt;-</span> cluster_profiles_combined <span class="sc">%&gt;%</span></span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"white"</span>, <span class="st">"black"</span>, <span class="st">"hisp"</span>, <span class="st">"asian"</span>),</span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"Demographic"</span>, <span class="at">values_to =</span> <span class="st">"Proportion"</span>)</span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot stacked bar charts of demographic makeup for each labeled cluster</span></span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cluster_profiles_long, <span class="fu">aes</span>(<span class="at">x =</span> label, <span class="at">y =</span> Proportion, <span class="at">fill =</span> Demographic)) <span class="sc">+</span></span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"stack"</span>) <span class="sc">+</span></span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Clustering_Solution <span class="sc">~</span> ., <span class="at">scales =</span> <span class="st">"free_x"</span>) <span class="sc">+</span>  <span class="co"># Facet vertically by clustering solution</span></span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">""</span>,</span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Cluster Label"</span>,</span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Proportion of Demographic Group"</span>,</span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Demographic Group"</span></span>
<span id="cb19-60"><a href="#cb19-60" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb19-61"><a href="#cb19-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb19-62"><a href="#cb19-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb19-63"><a href="#cb19-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb19-64"><a href="#cb19-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb19-65"><a href="#cb19-65" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/explore-demographics-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">(a) Four Clusters</figcaption>
</figure>
</div>
</div>
<p>Demographic Makeup of Labeled Clusters for Different Clustering Solutions: (a) Four Clusters, (b) Five Clusters, and (c) Six Clusters.</p>
</div>
<p>We can explore how this plays out for a specific observation. For example, take the first census tract in the data frame for the year <code>2020</code>. This tract’s racial composition was <code>58%</code> Black and <code>30%</code> Hispanic with small shares of Whites and Asians. With the four cluster solution, this tract was classified into class 1, <code>Majority Black</code>. For the five cluster solution, it was also classified as <code>Majority Black</code>, and for the six cluster solution, <code>Black and Hispanic</code>. In 1990, that same tract was <code>34%</code> black and <code>61%</code> Hispanic, resulting in the tract being classified as <code>Majority Hispanic</code> by all three clustering solutions. When looking at change over time, the neighborhood will either be registered as transitioning from <code>Majority Hispanic</code> to either <code>Majority Black</code> or <code>Black and Hispanic</code>, depending on the final cluster solution. In this instance, the 6 cluster solution provides a more accurate portrayal of the dynamics - while the neighborhood did technically become majority Black, there is still a significant Hispanic presence, a detail that would have been omitted by limiting the number of groups.</p>
<p>Finally, we can examine the spatial distribution of these clustering solutions to help aid in the final determination for the sequence analysis. Since we did the cluster analysis on all decades, for this purpose, we will contrast the 4, 5, and 6 cluster solutions just for 2020. All three maps depict a similar spatial pattern, but with a more fragmented pattern in the case of the 6 cluster solution. For example, the first two maps show contiguous tracts of the predominantly Black cluster, but the third map shows the emergence of the <code>Black and Hispanic</code> group largely forming on the outskirts of this spatial cluster. Another aparent distinction is the large spatial cluster of the <code>Asian</code> cluster in Queens, which had been labeled as <code>Mixed</code> in the 4 cluster solution.</p>
<p>To better understand details on racial neighborhood transitions, we will go with the larger number of clusters, 6, despite the mathematical preference for a 3 cluster solution. Our result illustrates the demographic distribution of labeled clusters for different clustering solutions: (a) four clusters, (b) five clusters, and (c) six clusters.</p>
<div class="cell" data-fig.label="demographic-distribution">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter data for the year 2020 and merge labels with tract data for mapping</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>tract_clusters_2020 <span class="ot">&lt;-</span> tract <span class="sc">%&gt;%</span> <span class="fu">erase_water</span>(<span class="at">area_threshold =</span> <span class="fl">0.9</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(census_long <span class="sc">%&gt;%</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2020</span>) <span class="sc">%&gt;%</span>  <span class="co"># Filter for the year 2020</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>              <span class="fu">select</span>(TRTID10, cluster_4, cluster_5, cluster_6, label_4, label_5, label_6), <span class="at">by =</span> <span class="st">"TRTID10"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"cluster_4"</span>, <span class="st">"cluster_5"</span>, <span class="st">"cluster_6"</span>),</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"ClusterSolution"</span>, <span class="at">values_to =</span> <span class="st">"Cluster"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"label_4"</span>, <span class="st">"label_5"</span>, <span class="st">"label_6"</span>),</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"LabelSolution"</span>, <span class="at">values_to =</span> <span class="st">"Label"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_replace</span>(ClusterSolution, <span class="st">"cluster_"</span>, <span class="st">""</span>) <span class="sc">==</span> <span class="fu">str_replace</span>(LabelSolution, <span class="st">"label_"</span>, <span class="st">""</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Label =</span> <span class="fu">factor</span>(Label)) <span class="sc">%&gt;%</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ClusterSolution =</span> <span class="fu">recode</span>(ClusterSolution,</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"cluster_4"</span> <span class="ot">=</span> <span class="st">"4 Clusters"</span>,</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"cluster_5"</span> <span class="ot">=</span> <span class="st">"5 Clusters"</span>,</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"cluster_6"</span> <span class="ot">=</span> <span class="st">"6 Clusters"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ClusterSolution =</span> <span class="fu">factor</span>(ClusterSolution, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"4 Clusters"</span>, <span class="st">"5 Clusters"</span>, <span class="st">"6 Clusters"</span>)))</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the base plot with the labeled clusters</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>base_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(tract_clusters_2020) <span class="sc">+</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Label), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span>  <span class="co"># Use the Label field for fill</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> nyc_counties, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span>  <span class="co"># Add county outlines</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> ClusterSolution, <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Facet horizontally by clustering solution</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"3 White"</span> <span class="ot">=</span> <span class="st">"#F0E442"</span>, <span class="st">"2 Hispanic"</span> <span class="ot">=</span> <span class="st">"#D55E00"</span>, </span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>               <span class="st">"1 Black"</span> <span class="ot">=</span> <span class="st">"#0072B2"</span>, <span class="st">"5 Asian"</span> <span class="ot">=</span> <span class="st">"#CC79A7"</span>, </span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>               <span class="st">"4 Mixed"</span> <span class="ot">=</span> <span class="st">"#009E73"</span>, <span class="st">"6 Black and Hispanic"</span> <span class="ot">=</span> <span class="st">"#56B4E9"</span>),</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Black"</span>, <span class="st">"Hispanic"</span>, <span class="st">"White"</span>, <span class="st">"Asian"</span>, <span class="st">"Mixed"</span>, <span class="st">"Black and Hispanic"</span>)  <span class="co"># Remove numbers from labels</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">fill =</span> <span class="cn">NULL</span>) <span class="sc">+</span>  <span class="co"># Remove the title and set fill to NULL to remove "Label"</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> .<span class="dv">5</span>, <span class="at">vjust =</span> .<span class="dv">1</span>, <span class="at">face =</span> <span class="st">"italic"</span>, <span class="at">size =</span> <span class="dv">12</span>),  <span class="co"># Center facet labels</span></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,  <span class="co"># Place the legend at the bottom</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),  <span class="co"># Ensure legend title is blank</span></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">1</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>, <span class="at">label.position =</span> <span class="st">"bottom"</span>))  <span class="co"># Place category names under the boxes</span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the plot</span></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(base_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/demographic-distribution-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">(a) Four Clusters</figcaption>
</figure>
</div>
</div>
<p>Demographic Distribution of Labeled Clusters for Different Clustering Solutions: (a) Four Clusters, (b) Five Clusters, and (c) Six Clusters.</p>
</div>
<p>We can begin with a simple exploration of the spatial changes over time in the maps showing the six clusters from 1980-2020 in a series of small multiples. From these maps, we can pick out some general spatial patterns over time. For example, we can see the expanse of neighborhoods classified as majority White from 1980 significantly diminishes by 2020. The share of Hispanics is shown to increase over time in the northern sections of the City. Towards the East, we see neighborhoods generally transition from predominantly White in 1980 to White and Mixed Race and eventually to Asian by 2020. There are also some evident stable clusters. For instance, the two clusters of predominantly black neighborhoods in the South and Southeast appear quite table over time. However, the cluster of majority Black neighborhoods in towards the north of Manhattan is diminished, replaced by a Black and Hispanic classification.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>decades <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1980</span>, <span class="dv">1990</span>, <span class="dv">2000</span>, <span class="dv">2010</span>, <span class="dv">2020</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter and prepare data for mapping</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>tract_clusters_decades <span class="ot">&lt;-</span> tract <span class="sc">%&gt;%</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(census_long <span class="sc">%&gt;%</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>              <span class="fu">select</span>(TRTID10, year, label_6), <span class="at">by =</span> <span class="st">"TRTID10"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(label_6)) </span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Set factor levels for year to ensure proper ordering</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>tract_clusters_decades <span class="ot">&lt;-</span> tract_clusters_decades <span class="sc">%&gt;%</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">factor</span>(year, <span class="at">levels =</span> decades))</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot faceted maps for each decade (year)</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tract_clusters_decades) <span class="sc">+</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> label_6), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span>  <span class="co"># Use factor to ensure proper color assignment</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> nyc_counties, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span>  <span class="co"># Add county outlines</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> year, <span class="at">ncol =</span> <span class="dv">5</span>) <span class="sc">+</span>  <span class="co"># Facet by year with 5 columns</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"3 White"</span> <span class="ot">=</span> <span class="st">"#F0E442"</span>, <span class="st">"2 Hispanic"</span> <span class="ot">=</span> <span class="st">"#D55E00"</span>, <span class="st">"1 Black"</span> <span class="ot">=</span> <span class="st">"#0072B2"</span>,</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>               <span class="st">"5 Asian"</span> <span class="ot">=</span> <span class="st">"#CC79A7"</span>, <span class="st">"4 Mixed"</span> <span class="ot">=</span> <span class="st">"#009E73"</span>, <span class="st">"6 Black and Hispanic"</span> <span class="ot">=</span> <span class="st">"#56B4E9"</span>),</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Black"</span>, <span class="st">"Hispanic"</span>, <span class="st">"White"</span>, <span class="st">"Asian"</span>, <span class="st">"Mixed"</span>, <span class="st">"Black and Hispanic"</span>),  <span class="co"># Remove numbers from labels</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">""</span>  <span class="co"># Remove legend title</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">" "</span>, <span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"gray"</span>),  <span class="co"># Set the title color to gray</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,  <span class="co"># Move legend to the bottom</span></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.direction =</span> <span class="st">"horizontal"</span>,  <span class="co"># Make the legend horizontal</span></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),  <span class="co"># Ensure the legend title is blank</span></span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="fl">0.6</span>, <span class="st">"cm"</span>),  <span class="co"># Set consistent size for legend boxes</span></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.height =</span> <span class="fu">unit</span>(<span class="fl">0.6</span>, <span class="st">"cm"</span>),  <span class="co"># Set consistent height for legend boxes</span></span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.width =</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">"cm"</span>)  <span class="co"># Set consistent width for legend boxes</span></span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="fu">guide_legend</span>(</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">nrow =</span> <span class="dv">1</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>, <span class="at">label.position =</span> <span class="st">"bottom"</span>  <span class="co"># Place category names under the legend boxes</span></span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>  )  <span class="co"># Combine all legend entries into a single row</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/smallmultiples-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the plot</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(base_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/smallmultiples-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="sequence-analysis" class="level3">
<h3 class="anchored" data-anchor-id="sequence-analysis">Sequence Analysis</h3>
<p>Our objective with the sequence classification is to come up with a typology of neighborhood sequences over time to describe general pathways of change. Each neighborhood has a sequence of classes over time, one of 6 categorical groups for each of the five decennial census values from 1980-2020. The first step in the analysis is to convert the data frame into a sequence for each neighborhood. We can see an illustrative example of the longitudinal sequences from the first five records. Classes are separated by a dash (-). There are 2122 sequences in the dataset and 197 unique sequences; all sequences are displayed in the plot below. Thus, the purpose of clustering the sequences is to extract the general patterns present from the set of all sequences.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the data from long to wide format to have a sequence for each neighborhood</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming census_long is your data frame</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>census_wide <span class="ot">&lt;-</span> tract_clusters_decades <span class="sc">%&gt;%</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(TRTID10, year, label_6) <span class="sc">%&gt;%</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> year, <span class="at">values_from =</span> label_6)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename the columns to show only the year (remove "cluster_" prefix if it was added during previous steps)</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(census_wide) <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"cluster_"</span>, <span class="st">""</span>, <span class="fu">colnames</span>(census_wide))</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure columns are in the correct order by year</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>census_wide <span class="ot">&lt;-</span> census_wide <span class="sc">%&gt;%</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(TRTID10, <span class="st">`</span><span class="at">1980</span><span class="st">`</span>, <span class="st">`</span><span class="at">1990</span><span class="st">`</span>, <span class="st">`</span><span class="at">2000</span><span class="st">`</span>, <span class="st">`</span><span class="at">2010</span><span class="st">`</span>, <span class="st">`</span><span class="at">2020</span><span class="st">`</span>)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure the sequence columns are factors</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>census_wide <span class="ot">&lt;-</span> census_wide <span class="sc">%&gt;%</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"19"</span>) <span class="sc">|</span> <span class="fu">starts_with</span>(<span class="st">"20"</span>), as.factor))</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the distinct states (categories) in your sequences</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>unique_states <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">unlist</span>(census_wide[, <span class="sc">-</span><span class="dv">1</span>]))  <span class="co"># Exclude TRTID10 column</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>num_states <span class="ot">&lt;-</span> <span class="fu">length</span>(unique_states)</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(unique_states)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6 Black and Hispanic 2 Hispanic           4 Mixed             
[4] 3 White              1 Black              5 Asian             
Levels: 1 Black 2 Hispanic 3 White 4 Mixed 5 Asian 6 Black and Hispanic</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(num_states)  <span class="co"># Number of unique states</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the custom color palette with the correct colors</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>custom_palette <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"1 Black"</span> <span class="ot">=</span> <span class="st">"#0072B2"</span>,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2 Hispanic"</span> <span class="ot">=</span> <span class="st">"#D55E00"</span>,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"3 White"</span> <span class="ot">=</span> <span class="st">"#F0E442"</span>,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"4 Mixed"</span> <span class="ot">=</span> <span class="st">"#009E73"</span>,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"5 Asian"</span> <span class="ot">=</span> <span class="st">"#CC79A7"</span>,</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"6 Black and Hispanic"</span> <span class="ot">=</span> <span class="st">"#56B4E9"</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the sequence object with the renamed columns</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>sequence_data <span class="ot">&lt;-</span> <span class="fu">seqdef</span>(census_wide[, <span class="sc">-</span><span class="dv">1</span>], <span class="at">cpal =</span> custom_palette)  <span class="co"># Exclude the TRTID10 column</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the number of distinct sequences</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>num_sequences <span class="ot">&lt;-</span> <span class="fu">seqtab</span>(sequence_data, <span class="at">idx =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> nrow</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(num_sequences)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 197</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first few sequences</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sequence_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Sequence                                                                                      
1 6 Black and Hispanic-2 Hispanic-6 Black and Hispanic-6 Black and Hispanic-6 Black and Hispanic
2 2 Hispanic-2 Hispanic-2 Hispanic-2 Hispanic-2 Hispanic                                        
3 2 Hispanic-2 Hispanic-2 Hispanic-2 Hispanic-2 Hispanic                                        
4 2 Hispanic-2 Hispanic-2 Hispanic-2 Hispanic-2 Hispanic                                        
5 2 Hispanic-2 Hispanic-2 Hispanic-2 Hispanic-2 Hispanic                                        
6 4 Mixed-2 Hispanic-2 Hispanic-2 Hispanic-5 Asian                                              </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the sequences</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">seqIplot</span>(sequence_data,                                             <span class="co"># Sequence object</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">with.legend =</span> <span class="st">"right"</span>,                                <span class="co"># Display legend on right side of plot</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">cex.legend =</span> <span class="fl">0.6</span>,                                     <span class="co"># Change size of legend</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">"Neighborhood Racial and Ethnic Trajectories"</span>) <span class="co"># Plot title</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/createsequences-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The next objective is to compute the dissimilarity between all sequences. As described previously, we use the OMstrans algorithm to preserve the ordering of events as we are most interested in describing how neighborhoods have generally transitioned over time. We set a low value (<code>0.1</code>) for the parameter <code>otto</code> in the <code>seqdist</code> command which is the origin-transition trade-off weight. This emphasizes the ordering of sequence states. We also set a high <code>indel</code> cost of <code>3</code>. Finally, substitution costs are a function of the transition rate <code>TRATE</code> between states. This places a lower cost on more frequent transitions.</p>
<p>Once the cost matrix is established, we then cluster the sequences using the dissimilarity matrix as an input to generate the typology. We follow an iterative process in determining the optimal solution like the one described above for the <em>k</em> means clustering. In short, multiple solutions are tested and the resulting sequence clusters are visualized to inspect for heterogeneity. Because our clustering and distance matrix are optimized for describing transitions over time, we end up with one cluster that contains all neighborhoods that remained constant over time. These sequences are very different from one another in the neighborhood types they describe, but they all represent a pathway or sequences of no change.</p>
<p>To describe the resulting sequence clusters, we plot a Sequence Frequency Plot for each cluster. We settled on 14 trajectory clusters describing neighborhood racial and ethnic transitions from 1980 to 2020 in New York City. The Sequence Frequency Plots illustrate the sequences belonging to each cluster and the sequence bars are scaled to visualize the frequency of each sequence. A summary of the trajectories is as follows:</p>
<ol type="1">
<li>Hispanic Majority to Black and Hispanic</li>
<li>Stability Cluster</li>
<li>White and Mixed Race to Hispanic Majority</li>
<li>White to White and Mixed Race to Hispanic Majority</li>
<li>Black and Hispanic to Hispanic Majority</li>
<li>White Majority to White and Mixed Race</li>
<li>White and Mixed Race to Black and Hispanic</li>
<li>Black and Hispanic to Black Majority</li>
<li>White and Mixed Race to Asian Majority</li>
<li>White and Mixed Race to White Majority</li>
<li>Black and Hispanic to White and Mixed Race</li>
<li>White and Mixed Race to Asian Majority</li>
<li>Black Majority to Black and Hispanic</li>
<li>Black and Hispanic to Asian Majority</li>
</ol>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pass this palette to seqdef</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Define sequence data with custom color palette</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>sequence_data <span class="ot">&lt;-</span> <span class="fu">seqdef</span>(census_wide[, <span class="sc">-</span><span class="dv">1</span>], <span class="at">cpal =</span> custom_palette)  <span class="co"># Exclude the TRTID10 column</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute Optimal Matching (OM) distances using the TRATE cost method</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>costs <span class="ot">&lt;-</span> <span class="fu">seqcost</span>(sequence_data, <span class="at">method =</span> <span class="st">"TRATE"</span>)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>om_distances <span class="ot">&lt;-</span> <span class="fu">seqdist</span>(sequence_data, <span class="at">method =</span> <span class="st">"OMstran"</span>, <span class="at">indel =</span> <span class="dv">3</span>, <span class="at">sm =</span> costs<span class="sc">$</span>sm, <span class="at">otto =</span> <span class="fl">0.1</span>)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform hierarchical clustering using Ward's method on the OM distances</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>clusterward <span class="ot">&lt;-</span> <span class="fu">agnes</span>(om_distances, <span class="at">diss =</span> <span class="cn">TRUE</span>, <span class="at">method =</span> <span class="st">"ward"</span>)</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the number of clusters and assign clusters to the sequence data</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>num_clusters <span class="ot">&lt;-</span> <span class="dv">14</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> <span class="fu">cutree</span>(clusterward, <span class="at">k =</span> num_clusters)</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>census_wide<span class="sc">$</span>sequence_cluster <span class="ot">&lt;-</span> clusters</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Define cluster names for reference</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>cluster_names1 <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">"1 Black &amp; Hispanic to Hispanic Majority"</span>, </span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2 Stability"</span>, </span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"3 White Mixed Race to Hispanic"</span>, </span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">"4 White to Mixed Race to Hispanic Majority"</span>, </span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">"5 Majority White to Increasing Diversity"</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot sequences for clusters in groups, adjusting legend settings</span></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>plot_sequence_clusters <span class="ot">&lt;-</span> <span class="cf">function</span>(cluster_range) {</span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">seqfplot</span>(</span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>    sequence_data[census_wide<span class="sc">$</span>sequence_cluster <span class="sc">%in%</span> cluster_range, ], </span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> census_wide<span class="sc">$</span>sequence_cluster[census_wide<span class="sc">$</span>sequence_cluster <span class="sc">%in%</span> cluster_range], </span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">sortv =</span> <span class="st">"from.start"</span>, </span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">border =</span> <span class="cn">NA</span>, </span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">with.legend =</span> <span class="st">"right"</span>,         <span class="co"># Place the legend on the right</span></span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.prop =</span> <span class="fl">0.2</span>,             <span class="co"># Set the proportion of the plot area for the legend</span></span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.border =</span> <span class="cn">FALSE</span>          <span class="co"># Remove the border around the legend</span></span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot sequences for specified cluster ranges</span></span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_sequence_clusters</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/clustersequences-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_sequence_clusters</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/clustersequences-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_sequence_clusters</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/clustersequences-3.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_sequence_clusters</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/clustersequences-4.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_sequence_clusters</span>(<span class="dv">9</span><span class="sc">:</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/clustersequences-5.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_sequence_clusters</span>(<span class="dv">11</span><span class="sc">:</span><span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/clustersequences-6.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_sequence_clusters</span>(<span class="dv">13</span><span class="sc">:</span><span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/clustersequences-7.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Of these 14 pathways, there are 3 that lead to the formation of a neighborhood transitioning into a Hispanic Majority cluster by 2020. This includes Cluster 3 - showing neighborhoods that went from being a slight majority White, but with a mixture of other races in 1980 and 1990 to transitioning to majority Hispanic by 1990 or 2000. Some of these sequences indicate a continued transition towards becoming majority Asian in the later years. Further segmenting the sequences into more clusters may have separated out those trajectories, but for the sake of brevity, we leave them mixed in. Spatially, these are shown in orange on the map below and can be see clustered in Staten Island, Queens, and in the Northern portion of the city. They are also notably adjacent to neighborhoods indicated by the red color, those representing sequence cluster 4, transitioning from majority White to White and Mixed Race and then to Majority Hispanic. This latter cluster might represent the precursor to cluster 3, but are neighborhoods that made this transition from majority White later, where the changes took time to spatially spillover to adjacent neighborhoods, as indicated by the map. Both of these pathways depict a transition from largely White populations to largely Hispanic.</p>
<p>The third pathway depicting a transition to majority Hispanic is distinct. It is represented by cluster 5 showing a transition from either majority Black neighborhoods towards a mixed Hispanic and Black group and eventually majority Hispanic or, beginning the 1980 time stamp, in a more mixed Black and Hispanic state. Geographically, these neighborhoods are shown more in the northern sections of Manhattan and the Bronx.</p>
<p>From these two sets of sequence clusters, we can see that majority Hispanic neighborhoods in New York City have emerged out of either majority Black or Majority White neighborhoods over time.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/my-figure-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Neighborhoods Following Pathway to Hispanic Majority with White County Borders.</figcaption>
</figure>
</div>
</div>
</div>
<p>There are also 3 pathways leading to an Asian majority neighborhood type. These include clusters 9 and 12 which are also likely continuations of longer trajectories, that show a gradual transition from Majority White to White mixed race and eventually to Asian Majority. Geographically, these are clustered in the northern section of Queens. Sequence cluster 14 is more distinct in that the Asian majority transitioned from the Black and Hispanic mixed group and spatially, they are generally located in upper Manhattan and the Bronx.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/AsianPathways-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Neighborhoods Following Pathway to Asian Majority</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter data for Increasing White (clusters 10 and 11)</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>increasing_white_clusters <span class="ot">&lt;-</span> census_wide <span class="sc">%&gt;%</span> </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sequence_cluster <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">11</span>))  <span class="co"># Clusters 10 and 11 for increasing White</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter data for Increasing Black (clusters 1 and 8)</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>increasing_black_clusters <span class="ot">&lt;-</span> census_wide <span class="sc">%&gt;%</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sequence_cluster <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">8</span>))  <span class="co"># Clusters 1 and 8 for increasing Black</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Join the filtered data with the tract shapefile for each group</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>tract_increasing_white <span class="ot">&lt;-</span> tract <span class="sc">%&gt;%</span>  <span class="fu">erase_water</span>(<span class="at">area_threshold =</span> <span class="fl">0.75</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(increasing_white_clusters, <span class="at">by =</span> <span class="st">"TRTID10"</span>)  <span class="co"># Join spatial data for increasing White</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Fetching area water data for your dataset's location...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Erasing water area...
If this is slow, try a larger area threshold value.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>tract_increasing_black <span class="ot">&lt;-</span> tract <span class="sc">%&gt;%</span>   <span class="fu">erase_water</span>(<span class="at">area_threshold =</span> <span class="fl">0.75</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(increasing_black_clusters, <span class="at">by =</span> <span class="st">"TRTID10"</span>)  <span class="co"># Join spatial data for increasing Black</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Fetching area water data for your dataset's location...
Erasing water area...
If this is slow, try a larger area threshold value.</code></pre>
</div>
</div>
<p>There are two pathways for increasing both Black and White shares in a neighborhoods. Neighborhoods that became increasingly White either followed a trajectory from White mixed race to majority White (Cluster 10) or from either all Black or Black and Hispanic to White and Mixed race (11). Notably, this transition largely took place within the past 1-2 decades, aligning with when gentrification trends became accentuated in some cities, including New York. We see a clear cluster of this latter group in Brooklyn, a borough whose gentrification trends have been well documented <span class="citation" data-cites="chronopoulos2020s halasz2023between">(<a href="#ref-chronopoulos2020s" role="doc-biblioref">Chronopoulos 2020</a>; <a href="#ref-halasz2023between" role="doc-biblioref">Halasz 2023</a>)</span>.</p>
<p>For the case of increasing Black populations, Cluster 1 shows a pathway from Hispanic majority to mixed Black and Hispanic and Cluster 8 shows a gradual transition from Black and Hispanic to majority Black; a trend that largely begin towards the middle of the study period, around the 2000 census data mark. Spatially, the former is more dispersed, while the latter is depicted more clearly in the southern neighborhoods of Brooklyn.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/WhitePathways-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Neighborhoods Following Pathway to White Majority</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/Black Pathways-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Neighborhoods Following Pathway to Black Majority</figcaption>
</figure>
</div>
</div>
</div>
<p>Finally, of the sequences depicting no change from 1980 to 2020, shown in Cluster 2, the majority of those are for tracts with a racial majority: White, Hispanic, and Black. But those are followed by two stable sequences of neighborhoods with some racial diversity. The first is the majority White, but with a mixture of other races and the second is the mixed Black and Hispanic cluster. There is some debate in the literature whether racially mixed neighborhoods can be stable over time, or are they simply depicting a point along a pathway of change when one group will eventually become a majority. Research has shown that highly diverse neighborhoods are quite unstable over time, likely to transition to a less diverse state. In particular the transition from predominantly White towards majority Hispanic, results in a period of unstable racial mixture while that transition takes place <span class="citation" data-cites="wright2020instability">(<a href="#ref-wright2020instability" role="doc-biblioref">Wright et al. 2020</a>)</span>. Others have identified a small, but persistent set of racially diverse neighborhoods throughout the United States, but particularly in racially diverse metropolitan areas <span class="citation" data-cites="hipp2023persistent">(<a href="#ref-hipp2023persistent" role="doc-biblioref">Hipp and Kim 2023b</a>)</span>. Here, we find some evidence of stable, non-racially homogeneous Census Tracts.</p>
</section>
</section>
<section id="sec-conclusion" class="level2">
<h2 class="anchored" data-anchor-id="sec-conclusion">Conclusions</h2>
<p>This analysis showcases a method for developing and visualizing a typology of neighborhood change pathways. We used a case study of decennial racial and ethnic changes in New York City census tracts from 1980-2020. The workflow first involves developing a cross-sectional typology of classes describing the racial mixture of neighborhoods. To do so, we used an unsupervised classification approach, <em>k</em>-means to derive six such clusters.</p>
<p>We demonstrated how determining the number of clusters often falls to more of an art than a precise science as our final clustering for this analysis exceeded the mathematically optimal three clusters, but provided us with more nuance on the racial mixture of neighborhoods. We performed the cluster analysis on all census tracts in the city for each of the five decennial census time stamps at once to ensure a temporally consistent set of groupings. We then created sequences of neighborhood clusters over the study period and developed a typology of sequences that grouped them based on the similarity of how they changed over time. To do so, we used the OMtrans algorithm for computing sequence dissimilarity to ensure that the *ordering or sequencing of events was preserved. Finally, we mapped sequence clusters to spatially visualize neighborhoods that followed similar pathways of change. For our case study of the largest city in the United States, and one of the most diverse, we observed a decline in the number of majority White census tracts over time. We identified several pathways of change leading to majority Hispanic neighborhoods - emerging either out of previously majority White or Black neighborhoods. We also observed pathways leading to majority Asian tracts, transitioning from Black and Hispanic neighborhoods, largely in Queens. A smaller share of neighborhoods became either increasingly White or Black. Neighborhoods that saw an increase in the share of Whites, saw a notable increase in the transition from Black and Hispanic to White and mixed race over the past two decades. Neighborhoods that increased in the share of Blacks largely transitioned from Black and Hispanic to majority Black or from White and mixed race to Black and Hispanic. The benefits of the sequence analysis technique is in the clarity of the visuals for revealing common pathways of change. One of its drawbacks is that it requires segmenting continuous, longitudinal data into discrete, categorical groups. Other methods for clustering time series offer an alternative approach for visualizing trajectories over time.</p>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-ChappleZuk2016" class="csl-entry" role="listitem">
Chapple, K., and M. Zuk. 2016. <span>“Forewarned: The Use of Neighborhood Early Warning Systems for Gentrification and Displacement.”</span> <em>Cityscape</em> 18 (3): 109–30.
</div>
<div id="ref-chronopoulos2020s" class="csl-entry" role="listitem">
Chronopoulos, Themis. 2020. <span>“<span>‘What’s Happened to the People?’</span> Gentrification and Racial Segregation in Brooklyn.”</span> <em>Journal of African American Studies</em> 24: 549–72.
</div>
<div id="ref-delmelle2015five" class="csl-entry" role="listitem">
Delmelle, E. C. 2015. <span>“Five Decades of Neighborhood Classifications and Their Transitions: A Comparison of Four US Cities, 1970–2010.”</span> <em>Applied Geography</em> 57: 1–11.
</div>
<div id="ref-Delmelle2016" class="csl-entry" role="listitem">
———. 2016. <span>“Mapping the DNA of Urban Neighborhoods: Clustering Longitudinal Sequences of Neighborhood Socioeconomic Change.”</span> <em>Annals of the American Association of Geographers</em> 106 (1): 36–56.
</div>
<div id="ref-delmelle2017differentiating" class="csl-entry" role="listitem">
———. 2017. <span>“Differentiating Pathways of Neighborhood Change in 50 US Metropolitan Areas.”</span> <em>Environment and Planning A</em> 49 (10): 2402–24.
</div>
<div id="ref-Delmelle2022" class="csl-entry" role="listitem">
———. 2022. <span>“GIScience and Neighborhood Change: Toward an Understanding of Processes of Change.”</span> <em>Transactions in GIS</em> 26 (2): 567–84.
</div>
<div id="ref-farrell2011racial" class="csl-entry" role="listitem">
Farrell, Chad R, and Barrett A Lee. 2011. <span>“Racial Diversity and Change in Metropolitan Neighborhoods.”</span> <em>Social Science Research</em> 40 (4): 1108–23.
</div>
<div id="ref-frey2022new" class="csl-entry" role="listitem">
Frey, William H. 2022. <span>“A’new Great Migration’is Bringing Black Americans Back to the South.”</span>
</div>
<div id="ref-gabadinho2011analyzing" class="csl-entry" role="listitem">
Gabadinho, Alexis, Gilbert Ritschard, Nicolas S Müller, and Matthias Studer. 2011. <span>“Analyzing and Visualizing State Sequences in r with TraMineR.”</span> <em>Journal of Statistical Software</em> 40: 1–37.
</div>
<div id="ref-Galster2001" class="csl-entry" role="listitem">
Galster, G. 2001. <span>“On the Nature of Neighbourhood.”</span> <em>Urban Studies</em> 38 (12): 2111–24.
</div>
<div id="ref-GonzalezLeonardo2023" class="csl-entry" role="listitem">
González‐Leonardo, M., N. Newsham, and F. Rowe. 2023. <span>“Understanding Population Decline Trajectories in Spain Using Sequence Analysis.”</span> <em>Geographical Analysis</em> 55 (4): 495–516.
</div>
<div id="ref-halasz2023between" class="csl-entry" role="listitem">
Halasz, Judith R. 2023. <span>“Between Gentrification and Supergentrification: Hybrid Processes of Socio-Spatial Upscaling.”</span> <em>Journal of Urban Affairs</em> 45 (4): 771–96.
</div>
<div id="ref-HippKim2023" class="csl-entry" role="listitem">
Hipp, John R, and Jae Hong Kim. 2023a. <span>“Persistent Racial Diversity in Neighborhoods: What Explains It and What Are the Long-Term Consequences?”</span> <em>Urban Geography</em> 44 (4): 640–67.
</div>
<div id="ref-hipp2023persistent" class="csl-entry" role="listitem">
———. 2023b. <span>“Persistent Racial Diversity in Neighborhoods: What Explains It and What Are the Long-Term Consequences?”</span> <em>Urban Geography</em> 44 (4): 640–67.
</div>
<div id="ref-Landis2016" class="csl-entry" role="listitem">
Landis, J. D. 2016. <span>“Tracking and Explaining Neighborhood Socioeconomic Change in US Metropolitan Areas Between 1990 and 2010.”</span> <em>Housing Policy Debate</em> 26 (1): 2–52.
</div>
<div id="ref-logan2014interpolating" class="csl-entry" role="listitem">
Logan, John R, Zengwang Xu, and Brian J Stults. 2014. <span>“Interpolating US Decennial Census Tract Data from as Early as 1970 to 2010: A Longitudinal Tract Database.”</span> <em>The Professional Geographer</em> 66 (3): 412–20.
</div>
<div id="ref-patias2020scalable" class="csl-entry" role="listitem">
Patias, Nikos, Francisco Rowe, and Stefano Cavazzi. 2020. <span>“A Scalable Analytical Framework for Spatio-Temporal Analysis of Neighborhood Change: A Sequence Analysis Approach.”</span> In <em>Geospatial Technologies for Local and Regional Development: Proceedings of the 22nd AGILE Conference on Geographic Information Science 22</em>, 223–41. Springer.
</div>
<div id="ref-reibel2011neighborhood" class="csl-entry" role="listitem">
Reibel, Michael, and Moira Regelson. 2011. <span>“Neighborhood Racial and Ethnic Change: The Time Dimension in Segregation.”</span> <em>Urban Geography</em> 32 (3): 360–82.
</div>
<div id="ref-studer2016matters" class="csl-entry" role="listitem">
Studer, Matthias, and Gilbert Ritschard. 2016. <span>“What Matters in Differences Between Life Trajectories: A Comparative Review of Sequence Dissimilarity Measures.”</span> <em>Journal of the Royal Statistical Society Series A: Statistics in Society</em> 179 (2): 481–511.
</div>
<div id="ref-Terbeck2023" class="csl-entry" role="listitem">
Terbeck, F. J. 2023. <span>“The Impact of Regional and Local Population Trends on Suburban Poverty and Ethnoracial Composition Change: A Shift‐share Analysis of the Chicago Metropolitan Area in the 2000s.”</span> <em>Population, Space and Place</em> 28 (6): e2549.
</div>
<div id="ref-von2012clustering" class="csl-entry" role="listitem">
Von Luxburg, Ulrike, Robert C Williamson, and Isabelle Guyon. 2012. <span>“Clustering: Science or Art?”</span> In <em>Proceedings of ICML Workshop on Unsupervised and Transfer Learning</em>, 65–79. JMLR Workshop; Conference Proceedings.
</div>
<div id="ref-wright2020instability" class="csl-entry" role="listitem">
Wright, Richard, Mark Ellis, Steven R Holloway, and Gemma Catney. 2020. <span>“The Instability of Highly Racially Diverse Residential Neighborhoods in the United States.”</span> <em>Sociology of Race and Ethnicity</em> 6 (3): 365–81.
</div>
<div id="ref-Wright2014" class="csl-entry" role="listitem">
Wright, Richard, Mark Ellis, Steven R Holloway, and Sandy Wong. 2014. <span>“Patterns of Racial Diversity and Segregation in the United States: 1990–2010.”</span> <em>The Professional Geographer</em> 66 (2): 173–82.
</div>
<div id="ref-Zwiers2018" class="csl-entry" role="listitem">
Zwiers, M., M. van Ham, and D. Manley. 2018. <span>“Trajectories of Ethnic Neighbourhood Change: Spatial Patterns of Increasing Ethnic Diversity.”</span> <em>Population, Space and Place</em> 24 (2): e2094.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>